@model BuildingCondition.Db.Models.User
@using Microsoft.AspNetCore.Identity
@inject UserManager<IdentityUser> _userManager
@inject RoleManager<IdentityRole> _roleManager
@{RoleManager<IdentityRole> roleManager = _roleManager;}
@{UserManager<IdentityUser> userManager = _userManager;}

@{
    ViewData["Title"] = "Edit";
}

@await Html.PartialAsync("_LayoutHeader")

<section class="justify-content-center align-items-center text-center">
    <div class="row justify-content-center align-items-center text-center">
        <h1 class="h3 mb-3 font-weight-normal">Edit user data</h1>
    </div>
    <div class="row mt-5">
        <div class="col">
            <form asp-controller="User" asp-action="EditData" method="post">
                <input type="hidden" asp-for="Id" />
                <div class="form-group">
                    <input asp-for="FirstName" type="text" class="form-control" placeholder="First Name">
                </div>
                <div class="form-group">
                    <input asp-for="LastName" type="text" class="form-control" placeholder="Last Name">
                </div>
                <div class="form-group">
                    <input asp-for="Email" type="email" class="form-control" placeholder="E-mail">
                </div>
                <button type="submit" class="btn btn-primary btn-block">Save</button>
            </form>
        </div>
        <div class="col">
            <form asp-controller="User" asp-action="EditPassword" method="post">
                <input type="hidden" asp-for="Id" />
                <div class="form-group">
                    <input asp-for="PasswordHash" type="password" class="form-control" placeholder="Password">
                </div>
                <button type="submit" class="btn btn-primary btn-block">Save</button>
            </form>
        </div>
    </div>
    <div class="row mt-5">
        <div class="col">
            <h5>Gas Qualification Certificates</h5>
            <div class="d-flex justify-content-end">
                <a asp-controller="Certificate" asp-action="AddGas" class="btn btn-link text-success">
                    <i class="fas fa-plus-square"></i>
                </a>
            </div>
            <table class="table table-sm table-hover">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Certificate Number</th>
                        <th scope="col"></th>
                    </tr>
                </thead>
                <tbody>
                    @{ var count = 0; }
                    @foreach (var gasQualificationCertificate in Model.GasQualificationCertificates)
                    {
                        count++;
                        <tr>
                            <th scope="row">@count</th>
                            <td>@gasQualificationCertificate.CertificateNumber</td>
                            <td>
                                <a asp-controller="Certificate" asp-action="GasEdit" asp-route-id="@gasQualificationCertificate.Id" class="btn btn-link text-warning">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <a asp-controller="Certificate" asp-action="GasDelete" asp-route-id="@gasQualificationCertificate.Id" class="btn btn-link text-danger">
                                    <i class="fas fa-trash-alt"></i>
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <div class="col">
            <h5>Electrical Qualification Certificates</h5>
            <div class="d-flex justify-content-end">
                <a asp-controller="Certificate" asp-action="AddElectrical" class="btn btn-link text-success">
                    <i class="fas fa-plus-square"></i>
                </a>
            </div>
            <table class="table table-sm table-hover">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Certificate Number</th>
                        <th scope="col"></th>
                    </tr>
                </thead>
                <tbody>
                    @{ count = 0; }
                    @foreach (var electricalQualificationCertificate in Model.ElectricalQualificationCertificates)
                    {
                        count++;
                        <tr>
                            <th scope="row">@count</th>
                            <td>@electricalQualificationCertificate.CertificateNumber</td>
                            <td>
                                <a asp-controller="Certificate" asp-action="ElectricalEdit" asp-route-id="@electricalQualificationCertificate.Id" class="btn btn-link text-warning">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <a asp-controller="Certificate" asp-action="ElectricalDelete" asp-route-id="@electricalQualificationCertificate.Id" class="btn btn-link text-danger">
                                    <i class="fas fa-trash-alt"></i>
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <div class="col">
            <h5>Permissions</h5>
            <table class="table table-sm table-hover">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Role</th>
                        <th scope="col"></th>
                    </tr>
                </thead>
                <tbody>
                    @{ count = 0; }
                    @foreach (var role in roleManager.Roles)
                    {
                        count++;
                        <tr>
                            <th scope="row">@count</th>
                            <td>@role.Name</td>
                            <td>
                                @*@if (userManager.IsInRoleAsync(Model, role.Name).Result)
                                {
                                    <a asp-controller="User" asp-action="RemoveFromRole" asp-route-userid="@Model.Id" asp-route-rolename="@role.Name" class="btn btn-link text-danger">
                                        <i class="fas fa-lock"></i>
                                    </a>
                                }
                                @if (!userManager.IsInRoleAsync(Model, role.Name).Result)
                                {
                                    <a asp-controller="User" asp-action="AddToRole" asp-route-userid="@Model.Id" asp-route-rolename="@role.Name" class="btn btn-link text-success">
                                        <i class="fas fa-lock-open"></i>
                                    </a>
                                }*@
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</section>
